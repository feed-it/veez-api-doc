# Exploitations

> Ce microservice a pour objectif d'importer des exploitations dans la base de donn√©es r√©f√©rentielle du client.

# Table des mati√®res

1. [üõ£Ô∏è Appel de la route](#appel-route)
2. [üìñ Body](#body)
3. [‚úÖ R√©sum√©](#resume)
4. [‚ÅâÔ∏è FAQ](#faq)

---

# Authentification ü™™

Ce microservice utilise l‚Äôauthentification **Bearer Token** pour s√©curiser les appels API.

[La documentation Authentification se trouve ici](authentification.md)

---

# <a id="appel-route"></a> Appel de la route üõ£Ô∏è

Pour importer des exploitations, effectuez un appel **HTTP POST** vers l‚Äôendpoint d√©di√© en fournissant les donn√©es n√©cessaires.

### url :

> https://api-9a4b7c2d6e1f8g3h0i5j2k7l4m9n6o1p2q.veez.myfeedit.com/farms/:year

### Headers

```http
Authorization: Bearer <yourTokenHere>
Content-Type: application/json
```

---

# <a id="body"></a> Body üìñ

Le body pass√© √† la requ√™te contient la ou les exploitations √† cr√©er dans votre base de donn√©es Veez.

Notre algorithme va chercher dans la base de donn√©es Veez l'exploitation qui correspond aux donn√©es transmises, pour ensuite y associer votre `codeAdh` (votre code interne).

Seules quelques props sont obligatoires, mais plus vous fournirez d'infos plus la recherche aura des chances d'aboutir. Voici la liste des props :

- `codeAdh` [obligatoire] : code adh√©rent du client (votre code interne)
- `farm` [obligatoire] : nom de l'exploitation
- `town` [obligatoire] : commune du si√®ge social de l'exploitation
- `townCodeInsee` : Code Officiel Geographique de la commune du si√®ge social de l'exploitation ([Source Insee](https://www.insee.fr/fr/information/8377162))
- `postalAddress` : adresse du si√®ge social de l'exploitation
- `siret` : siren ou siret de l'exploitation

Exemple de body :

```json
[
  {
    "codeAdh": "Adh-9876543",
    "farm": "GAEC FEEDIT",
    "town": "MONBOURG",
    "townCodeInsee": "33563",
    "postalAddress": "RUE DES SAUGES 33440 MONBOURG",
    "siret": "123456789"
  },
  {
    "codeAdh": "Adh-4562189",
    "farm": "SCEA TERRAVISIO",
    "town": "MONHEURT"
  }
]
```

---

# ‚úÖ <a id="resume"></a> R√©sum√©

#### üîê S√©curit√© et authentification

- **Authentification en deux √©tapes** :
  1. **Basic Auth** (envoi du `username` et `password` en Base64).
  2. **Obtention d'un Token JWT** via Keycloak.
- **Utilisation obligatoire du Bearer Token** pour toutes les requ√™tes apr√®s authentification.

#### üì§ Processus d'import des exploitations

1. **Appel de l'API d'authentification** pour r√©cup√©rer un **token JWT**.
2. **Envoi d'une requ√™te HTTP POST** √† l'endpoint d√©di√© en incluant :
   - Un JSON contenant les infos des exploitations.
3. **R√©ponse de l'API** indiquant le succ√®s ou l'√©chec de l'import.

#### üìå Format attendu des donn√©es

Chaque objet JSON repr√©sentant une exploitation doit contenir les informations suivantes :

- `codeAdh` [obligatoire]
- `farm` [obligatoire]
- `town` [obligatoire]
- `townCodeInsee`
- `postalAddress`
- `siret`

#### ‚úÖ Exemple de r√©ponse apr√®s insertion r√©ussie

```json
{
  "success": true,
  "message": "Successfully inserted 4 new farms into \"farms\" table",
  "requestedYear": "2025",
  "businessEntity": "FEEDIT"
}
```

---

# <a id="faq"></a> FAQ ‚ÅâÔ∏è

<details>
	<summary>‚ùî <u>Quels props doit contenir mon objet afin d'√™tre valide ?</u></summary>
	
	Chaque objet doit au moins contenir :
	
- `codeAdh`
- `farm`
- `town`
</details>

---

<details>
	<summary>‚ùî<u> Qui dois-je contacter en cas de besoin ?</u></summary>
	
	L'√©quipe Feed'it se fera un plaisir de r√©pondre a toutes les questions ! (contact@feed-it.io)
</details>

---

<details>
<summary>‚ùî <u>Comment savoir si √ßa a fonctionn√© ?</u></summary>
	
	Une r√©ponse sera fournie une fois l'insertion termin√©e.
<pre>
{
	"message": "Successfully inserted 7 farms in 2025 for FEEDIT"
}
</pre>
</details>

---

```txt

 :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
 ::::::::::::::::.       ::::::::::::::::::::::::::::::::::.    ::.....:::::::::::::::::::::::::::::::::
 :::::::::::::::  @@@@@@-:::::::::::::::::::::::::::::::::: @@@ .:.@@@:::.    .:::::::::::::::::::::::::
 ::::::::::::::: @@@   . ::::::::::::::::::::::::::::::::::  @@ .:.:@#.:: %@@%.::    .::::::::::::::::::
 ::::::::::::::: @@  ...:::::::::::::::::::::::::::::::::::  @@ .:..@+.:-.-@@..::.@@@ ::::::::::::::::::
 :::::::::::-.   @@    .::.........::::::......::::::        @@ .:.*@@.::.    .   .@     .::::::::::::::
 :::::::::::- @@@@@@@@@....@@@@@@%..:::.*%@@%%#.:::.  @@@@@@@@@ .::....::.+@@..@@@@@@@@@@.::::::::::::::
 :::::::::::-    @@    ..@@@....#@@..:-##:....##+.. #@@%    @@@ .::::::::. %% .   :@     .::::::::::::::
 ::::::::::::::. @@  ::.@@=......=@#.:*#.......*#. .@@  .::  @@ .::::::::. %% .:. @@. ..::::::::::::::::
 ::::::::::::::: @@  -:.@@@@@@@@@@@@.:*#%@@@@@@%%: :@@  :::  @@ .::::::::. %% .:. @@: ::::::::::::::::::
 ::::::::::::::: @@  ::.@@:..........:*#.........: :@@  ::   @@  ::::::::. %% .:. @@. ::::::::::::::::::
 ::::::::::::::: @@: -:..@@@.......=..+##.......-:. @@:    @@@@  -:::::::. %% .:: @@:     ::::::::::::::
 ::::::::::::::: @@@ -::..@@@@@@@@@@.:..#%%%%%%@%::  @@@@@@@ @@@ ::::::::..@@=.:: #@@@@@@ ::::::::::::::
 :::::::::::::::    .-:::............:::.........:::             -::::::::    .::.        ::::::::::::::
 :::::::::::::::::.::::::::::::::::::::::::::::::::::::...::::::::::::::::::::::::::...:::::::::::::::::
 :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

```
